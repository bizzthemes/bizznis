<?php
/*
	WARNING! DO NOT EDIT THIS FILE!
	This file is part of the core Bizznis parent theme. 
	Please do all modifications in the form of a child theme.
*/

/**
 * This file controls the top-level Bizznis menu.
 *
 * @since 1.0.0
 */
add_action( 'after_setup_theme', 'bizznis_add_admin_menu' );
function bizznis_add_admin_menu() {
	# Stop here, if not viewing the admin
	if ( ! is_admin() )
		return;
	# Global variable
	global $_bizznis_admin_settings;
	# Don't add menu item if programatically disabled
	if ( ! current_theme_supports( 'bizznis-admin-menu' ) )
		return;
	# Current user object
	$user = wp_get_current_user();
	# Don't add menu item if disabled for current user
	if ( ! get_the_author_meta( 'bizznis_admin_menu', $user->ID ) )
		return;
	# Add "Settings" submenu item
	new Bizznis_Admin_Settings;
	# Hook here to create submenus
	do_action( 'bizznis_admin_menu' );

}

/**
 * Add submenu items under Bizznis in admin menu.
 *
 * @since 0.2.0
 */
add_action( 'bizznis_admin_menu', 'bizznis_add_admin_submenus' );
function bizznis_add_admin_submenus() {
	# Stop here, if not viewing the admin
	if ( ! is_admin() )
		return;
	# Global variable
	global $_bizznis_admin_seo_settings;
	# Don't add submenu items if Bizznis menu is disabled
	if( ! current_theme_supports( 'bizznis-admin-menu' ) )
		return;
	# Get current user
	$user = wp_get_current_user();
	# Add "SEO Settings" submenu item
	if ( current_theme_supports( 'bizznis-seo-settings-menu' ) && get_the_author_meta( 'bizznis_seo_settings_menu', $user->ID ) ) {
		$_bizznis_admin_seo_settings = new Bizznis_Admin_SEO_Settings;
	}
	# Add the about page (no menu)
	new Bizznis_Admin_About;
}

/**
 * Add the feedback link to admin navigation
 *
 * @since 1.0.0
 */
add_action( 'bizznis_admin_title_right', 'bizznis_add_admin_menu_feedback', 15 );
function bizznis_add_admin_menu_feedback() {
	printf( __( '<a href="%s" target="_blank" class="feedback" title="Report a Bug">Report a Bug</a>', 'bizznis' ), esc_url( 'https://github.com/bizzthemes/bizznis/issues' ) );
}

/**
 * Add archive settings page to relevant custom post type registrations.
 *
 * An instance of `Bizznis_Admin_CPT_Archive_Settings` is instantiated for each relevant CPT, assigned to an individual
 * global variable.
 *
 * @since 1.0.0
 */
add_action( 'admin_menu', 'bizznis_add_cpt_archive_page', 5 );
function bizznis_add_cpt_archive_page() {
	$post_types = bizznis_get_cpt_archive_types();
	foreach( $post_types as $post_type ) {
		if ( bizznis_has_post_type_archive_support( $post_type->name ) ) {
			$admin_object_name = '_bizznis_admin_cpt_archives_' . $post_type->name;
			global ${$admin_object_name};
			${$admin_object_name} = new Bizznis_Admin_CPT_Archive_Settings( $post_type );
		}
	}
}